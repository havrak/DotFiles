#!/usr/bin/env bash

WALL1="$HOME/bin/scripts/files/wall1.png"
WALL2="$HOME/bin/scripts/files/wall2.png"

if [ ! -z "$1" ]; then
    if [ "$XDG_SESSION_TYPE" == "wayland" ]; then
        MONITOR_COUNT=$(hyprctl monitors | grep "Monitor" | wc -l)
        MENU_CMD='tofi  --prompt-text="Monitor"'
    else
        MONITOR_COUNT=$(xrandr | grep " connected" | wc -l)
        MENU_CMD='dmenu -i -p "Select monitor for wallpaper"'
    fi
    if [ "$MONITOR_COUNT" -gt "1" ]; then
        CHOICE=$(printf "both\n1st\n2nd" | eval "$MENU_CMD")

        case "$CHOICE" in
            "both")
                cp "$1" "$WALL1" && cp "$1" "$WALL2" && notify-send -i "$WALL1" "Both wallpapers changed."
                ;;
            "1st")
                cp "$1" "$WALL1" && notify-send -i "$WALL1" "1st wallpaper changed."
                ;;
            "2nd")
                cp "$1" "$WALL2" && notify-send -i "$WALL2" "2nd wallpaper changed."
                ;;
        esac
    else
        cp "$1" "$WALL1" && notify-send -i "$WALL1" "Wallpaper changed."
				WALL2=$WALL1
    fi
fi

# --- Apply Wallpaper ---
if [ "$XDG_SESSION_TYPE" == "wayland" ]; then
    killall swaybg 2>/dev/null
    echo "Setting wallpaper"

    swaybg -o eDP-1 -m fill -i "$WALL1" \
           -o eDP-2 -m fill -i "$WALL1" \
           -o DP-1 -m fill -i "$WALL2" \
           -o DP-2 -m fill -i "$WALL2" \
           -o HDMI-A-1 -m fill -i "$WALL2" \
           -o HDMI-A-2 -m fill -i "$WALL2" &
else
    xwallpaper \
        --output eDP-1 --zoom "$WALL1" \
        --output DP-1  --zoom "$WALL2" \
        --output HDMI-1  --zoom "$WALL2" \
        --output HDMI-2  --zoom "$WALL2" \
        --output eDP1 --zoom "$WALL1"  \
        --output DP1  --zoom "$WALL2" \
        --output HDMI1  --zoom "$WALL2" \
        --output HDMI2  --zoom "$WALL2" 2> /dev/null
fi

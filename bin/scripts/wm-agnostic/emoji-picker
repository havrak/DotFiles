#!/bin/sh

# Detect Session
if [ "$XDG_SESSION_TYPE" = "wayland" ]; then
    # Wayland/Hyprland Settings
    menu_cmd="tofi --height=20% --prompt-text=Clipboard --horizontal=false --result-spacing=0 --num-results=20"
    copy_cmd="wl-copy"
    # Using hyprctl for typing is more native/stable on Hyprland than wtype
    type_cmd() { hyprctl dispatch sendtext "$1"; }
else
    # X11 Settings
    menu_cmd="dmenu -i -l 30"
    copy_cmd="xclip -selection clipboard"
    # Secondary xclip command for primary selection (middle click)
    copy_cmd_primary="xclip -selection primary"
    type_cmd() { xdotool type "$1"; }
fi

chosen=$(cut -d ';' -f1 ~/bin/scripts/files/emoji | $menu_cmd | sed "s/ .*//")

[ -z "$chosen" ] && exit

if [ -n "$1" ]; then
    type_cmd "$chosen"
else
    echo "$chosen" | tr -d '\n' | $copy_cmd
    if [ "$XDG_SESSION_TYPE" != "wayland" ]; then
        echo "$chosen" | tr -d '\n' | $copy_cmd_primary
    fi

    notify-send "'$chosen' copied to clipboard." &
fi

